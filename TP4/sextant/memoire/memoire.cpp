/*
 * memoire.cpp
 *
 *  Created on: 27 aoï¿½t 2008
 *      Author: jmenaud
 */
#include "memoire.h"

void *debut;
int taille;
Ecran *ec;

void mem_setup(void * begin, int size,Ecran *ecran) {
	debut=begin;
	taille=size;
	ec=ecran;
}


void * getmem(long unsigned int nbytes)
{
	void *adresse;
	char *temp;
	int i = (int) debut;

	/* QUESTION 6 */

	ec->sautDeLigne();
	ec->afficherMot("Adresse de debut : ");
	ec->afficherBase((unsigned int) i, 16, BLANC);
	ec->sautDeLigne();
	ec->afficherMot("Taille passee en param de getmem : ");
	ec->afficherBase((unsigned int) nbytes, 10, BLANC);
	ec->sautDeLigne();

	i += nbytes;
	ec->afficherMot("Adresse de fin : ");
	ec->afficherBase((unsigned int) i, 16, BLANC);
	ec->sautDeLigne();

	adresse = debut;
	debut = (void *) i;

	return adresse;
}

void* operator new(long unsigned int taille) {
	void * temp;

	temp = getmem(taille);

	ec->afficherMot("Entree dans constructeur, adresse :  ",BLANC);
	ec->afficherBase((unsigned int) temp, 16, BLANC);
	ec->sautDeLigne();
	ec->afficherMot("Entree dans constructeur, taille :  ",BLANC);
	ec->afficherBase((unsigned int) taille, 10, BLANC);
	ec->sautDeLigne();

	return temp;
}

void operator delete(void *adresse) {
    int *obj = (int *)adresse;
    freemem(*obj, sizeof(*obj));
}

void freemem(int adresse, int taille) {
	for (int i = 0; i < taille; i++) {
		ecrireOctet(0, adresse+i);
	}
}