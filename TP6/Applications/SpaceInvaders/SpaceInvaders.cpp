/*
 * SpaceInvader.cpp
 *
 *  Created on: 17 oct. 2008
 *      Author: Aurélien
 */

#include "SpaceInvaders.h"

SpaceInvaders::SpaceInvaders(Ecran *ec, TimerSpaceInvaders *t) {
	ecran = ec;
	EntiteBase::setEcran(ecran);
	ecran->effacerEcran(NOIR);

	timer = t;
	//On fixe ici le timer du déplacement des aliens, en ms.
	timer->setTimerDeplacementAliens(70);

	espace = new Espace(new FondEspace(), ecran, timer);

	test();
	//Création du bloc alien. Ne possède qu'un seul alien ^^
	BlocAliens *blocAliens;
	blocAliens = new BlocAliens(timer, ecran);
	blocAliens->start();

	//Test
	//Le canon bouge à la vitesse d'un missile. Partie bien évidemment à modifier !
	Canon *canon;
	canon = EntiteFactory::creerCanon2(timer, 23, 46);
	canon->start();

	//Une attente active est effectuée ici.
	//while(true) {
		timer->handler(ecran);
	//}
}


void SpaceInvaders::test(){
	//Ajout d'une entité alien en haut à gauche.
	Alien *alien;
	alien = EntiteFactory::creerAlienRobot(2, 18);
	espace->setEntite(alien);

	//Ajout en série.
	int origineX = 28;
	int origineY = 2;
	for(int i=0; i<9; i++){
		if(i != 5 && i != 0)
			espace->setEntite(EntiteFactory::creerAlienRobot(origineY, origineX+5*i));
		espace->setEntite(EntiteFactory::creerAlienDoob(origineY+3, origineX+5*i));
		if(i != 3 && i != 4){
			for(int j=0; j<2; j++){
				if(i != 6 && j != 0 || i != 5 && j != 1)
					espace->setEntite(EntiteFactory::creerAlienBat(origineY+6+3*j, origineX+5*i));
			}
		}
	}

	espace->setEntite(EntiteFactory::creerCanon(timer, 23, 37));

	int bunkerX = 1;
	int bunkerY = 19;
	for(int k=0; k<8; k++){
		for(int i=0; i<3; i++){
			for(int j=0; j<7; j++){
				if(!(i==0 && (j==0 || j==6) || i==2 && j==3))
					espace->setEntite(EntiteFactory::creerBunker(bunkerY+i, bunkerX+j+10*k));
			}
		}
	}

	//espace->setEntite(EntiteFactory::creerAlienPinguin(4, 4));
	espace->setEntite(EntiteFactory::creerAlienFish(6, 12));
	espace->setEntite(EntiteFactory::creerCanon2(timer, 23, 13));

	//espace->setEntite(creerAlienRobot(12, 12));

}
